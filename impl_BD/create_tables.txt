CREATE TABLE Bateau
(
idBateau INT,
idPartie INT FOREIGN KEY REFERENCES Partie(idPartie),
pseudo VARCHAR(255) FOREIGN KEY REFERENCES Joueur(pseudo),
taille INT,
pivotX INT,
pivotY INT,
orientation VARCHAR(255),
pointVie INT,
CONSTRAINT Bateau_pk PRIMARY KEY (idBateau, idPartie), --it's gonna blow
CONSTRAINT Bateu_chk CHECK ((orientation='nord' OR orientation='sud' OR orientation='est' OR orientation='ouest') AND
                            pointVie>=0 AND pivotX>=0 AND pivotX<8 AND pivotY>=0 AND pivotY<8 AND (taille=2 OR taille=3) AND
                            (
                            CASE 
                            WHEN orientation='nord' THEN 
                                  CASE 
                                  WHEN pivotY+taille < 8 THEN 1 
                                  ELSE 0
                                  END
                            END

                            AND                            
                              
                            CASE 
                            WHEN orientation='sud' THEN 
                                  CASE 
                                  WHEN pivotY-taille >= 0 THEN 1 
                                  ELSE 0
                                  END
                            END

                            AND                            
                              
                            CASE 
                            WHEN orientation='est' THEN 
                                  CASE 
                                  WHEN pivotX+taille < 8 THEN 1 
                                  ELSE 0
                                  END
                            END
                            
                            AND                            
                              
                            CASE 
                            WHEN orientation='ouest' THEN 
                                  CASE 
                                  WHEN pivotX-taille >= 0 THEN 1 
                                  ELSE 0
                                  END
                            END
                            )
                            )
);

CREATE TABLE Partie
(
idPartie INT,
dateDemarage DATE,
CONSTRAINT Partie_pk PRIMARY KEY (idPartie),
CONSTRAINT Partie_chk CHECK(dateDemarage > '01-JAN-2015') --it's gonna blow
);

CREATE TABLE Joueur
(
pseudo VARCHAR(255),
nom VARCHAR(255),
prenom VARCHAR(255),
dateNaissance DATE,
adrRue VARCHAR(255),
adrNumero INT,
adrCodePostal INT,
adrVille VARCHAR(255),
CONSTRAINT Joueur_pk PRIMARY KEY (pseudo),
CONSTRAINT Joueur_chk CHECK(dateNaissance > 01-JAN-1900 AND adrNumero > 0 AND adrCodePostal > 0)
);

CREATE TABLE Action
(
idAction INT,
idPartie INT FOREIGN KEY REFERENCES Partie(idPartie),
idBateau INT FOREIGN KEY REFERENCES Bateau(idBateau),
tour INT,
CONSTRAINT Action_pk PRIMARY KEY (idAction,idPartie)
);

CREATE TABLE ActionDeplacement
(
idAction INT,
idPartie INT FOREIGN KEY REFERENCES Partie(idPartie),
tour INT,
typeDeplacement VARCHAR(255),
CONSTRAINT ActionDepl_pk PRIMARY KEY (idAction,idPartie),
CONSTRAINT ActionDepl_chk CHECK ((typeDeplacement='droite' OR typeDeplacement='gauche' OR typeDeplacement='avancer' OR typeDeplacement='reculer')
);

CREATE TABLE ActionTir
(
idAction INT,
idPartie INT FOREIGN KEY REFERENCES Partie(idPartie),
tour INT,
cibleTirX INT,
cibleTirY INT,
CONSTRAINT ActionTir_pk PRIMARY KEY (idAction,idPartie)
CONSTRAINT ActionTir_chk CHECK (cibleTirX>=0 AND cibleTirX<8 AND cibleTirY>=0 AND cibleTirY<8)
);

CREATE TABLE Vainqueurs
(
idPartie INT FOREIGN KEY REFERENCES Partie(idPartie),
idBateau INT FOREIGN KEY REFERENCES Bateau(idBateau),
tour INT,
CONSTRAINT Vainqueurs_pk PRIMARY KEY (idPartie)
);

CREATE TABLE JoueursParPartie
(
pseudo VARCHAR(255) FOREIGN KEY REFERENCES Joueur(pseudo),
idPartie INT FOREIGN KEY REFERENCES Partie(idPartie),
CONSTRAINT JoueursParPartie_pk PRIMARY KEY (idPartie, pseudo)
);











